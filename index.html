// One-page kar/zarar yazılımı (modern tasarım - özet üstte, ROAS ayrı)
import React, { useState } from "react";
import { Card, CardContent } from "@/components/ui/card";
import { Button } from "@/components/ui/button";
import { Input } from "@/components/ui/input";
import { Label } from "@/components/ui/label";
import { RadioGroup, RadioGroupItem } from "@/components/ui/radio-group";
import { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from "@/components/ui/table";
import Papa from "papaparse";

export default function KarZararPaneli() {
  const [gelirler, setGelirler] = useState([]);
  const [giderler, setGiderler] = useState([]);
  const [gelirForm, setGelirForm] = useState({ kanal: "Web Sitesi", ay: "", yil: "", ciro: "", siparis: "", urun: "", urunTutari: "" });
  const [giderForm, setGiderForm] = useState({ kanal: "Web Sitesi", ay: "", yil: "", tur: "", tutar: "", kdv: "", aciklama: "" });

  const handleGelirEkle = () => {
    setGelirler([...gelirler, { ...gelirForm, ciro: parseFloat(gelirForm.ciro) }]);
    setGelirForm({ kanal: "Web Sitesi", ay: "", yil: "", ciro: "", siparis: "", urun: "", urunTutari: "" });
  };

  const handleGiderEkle = () => {
    setGiderler([...giderler, { ...giderForm, tutar: parseFloat(giderForm.tutar) }]);
    setGiderForm({ kanal: "Web Sitesi", ay: "", yil: "", tur: "", tutar: "", kdv: "", aciklama: "" });
  };

  const aylar = ["Ocak", "Şubat", "Mart", "Nisan", "Mayıs", "Haziran", "Temmuz", "Ağustos", "Eylül", "Ekim", "Kasım", "Aralık"];
  const yillar = [2023, 2024, 2025];
  const giderTurleri = ["Ürün Maliyeti", "Reklam", "Kargo", "Komisyon", "Operasyon"];

  const handleExcelImport = (e, type) => {
    Papa.parse(e.target.files[0], {
      header: true,
      complete: (results) => {
        const parsedData = results.data.map((item) => ({ ...item, tutar: parseFloat(item.tutar) }));
        if (type === "gelir") setGelirler([...gelirler, ...parsedData]);
        else setGiderler([...giderler, ...parsedData]);
      }
    });
  };

  const hesapla = (kanal) => {
    const kanalGelir = gelirler.filter((g) => g.kanal === kanal).reduce((sum, g) => sum + (parseFloat(g.ciro) || 0), 0);
    const kanalGider = giderler.filter((g) => g.kanal === kanal).reduce((sum, g) => sum + g.tutar, 0);
    let roasDegeri = "-";
    if (kanal === "Web Sitesi") {
      const reklamGideri = giderler.filter((g) => g.kanal === kanal && g.tur === "Reklam").reduce((sum, g) => sum + g.tutar, 0);
      roasDegeri = reklamGideri > 0 ? (kanalGelir / reklamGideri).toFixed(2) : "-";
    }
    return { ciro: kanalGelir, karZarar: kanalGelir - kanalGider, roas: roasDegeri };
  };

  const web = hesapla("Web Sitesi");
  const trendyol = hesapla("Trendyol");
  const toplam = { ciro: web.ciro + trendyol.ciro, karZarar: web.karZarar + trendyol.karZarar };

  return (
    <div className="grid grid-cols-1 gap-8 p-6 max-w-6xl mx-auto">

      <Card>
        <CardContent className="space-y-4">
          <h2 className="text-2xl font-bold mb-2">Genel Özet</h2>
          <Table>
            <TableHeader>
              <TableRow>
                <TableHead>Kanal</TableHead>
                <TableHead>Ciro</TableHead>
                <TableHead>Kar / Zarar</TableHead>
              </TableRow>
            </TableHeader>
            <TableBody>
              <TableRow>
                <TableCell>Web Sitesi</TableCell>
                <TableCell>{web.ciro.toFixed(2)} TL</TableCell>
                <TableCell>{web.karZarar.toFixed(2)} TL</TableCell>
              </TableRow>
              <TableRow>
                <TableCell>Trendyol</TableCell>
                <TableCell>{trendyol.ciro.toFixed(2)} TL</TableCell>
                <TableCell>{trendyol.karZarar.toFixed(2)} TL</TableCell>
              </TableRow>
              <TableRow className="font-bold">
                <TableCell>Toplam</TableCell>
                <TableCell>{toplam.ciro.toFixed(2)} TL</TableCell>
                <TableCell>{toplam.karZarar.toFixed(2)} TL</TableCell>
              </TableRow>
            </TableBody>
          </Table>
        </CardContent>
      </Card>

      <Card>
        <CardContent>
          <h2 className="text-xl font-semibold">Web Sitesi ROAS</h2>
          <p className="text-lg mt-2">{web.roas !== "-" ? `ROAS: ${web.roas}` : "ROAS hesaplanamadı (Reklam gideri eksik)"}</p>
        </CardContent>
      </Card>

      {/* GELİR GİRİŞİ */}
      {/* ... (aynı gelir ve gider formları buraya yazılacak, önceki koddan kopyalanarak modernleştirilebilir) */}

    </div>
  );
}
