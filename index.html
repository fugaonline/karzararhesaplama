<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Kar Zarar Paneli</title>
  <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
  <script src="https://unpkg.com/papaparse@5.4.1/papaparse.min.js"></script>
  <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-4">
  <div id="root"></div>

  <script type="text/babel">
    const { useState } = React;

    function KarZararPaneli() {
      const [gelirler, setGelirler] = useState([]);
      const [giderler, setGiderler] = useState([]);

      const aylar = ["Ocak", "Şubat", "Mart", "Nisan", "Mayıs", "Haziran", "Temmuz", "Ağustos", "Eylül", "Ekim", "Kasım", "Aralık"];
      const yillar = [2023, 2024, 2025];
      const giderTurleri = ["Ürün Maliyeti", "Reklam", "Kargo", "Komisyon", "Operasyon"];
      const kanalSecenekleri = ["Web Sitesi", "Trendyol", "Operasyonel Giderler", "Vergi"];

      const [gelirForm, setGelirForm] = useState({ kanal: "Web Sitesi", ay: "", yil: "", ciro: "", siparis: "", urun: "", urunTutari: "" });
      const [giderForm, setGiderForm] = useState({ kanal: "Web Sitesi", ay: "", yil: "", tur: "", tutar: "", kdv: "", aciklama: "" });

      const handleGelirEkle = () => {
        setGelirler([...gelirler, { ...gelirForm, ciro: parseFloat(gelirForm.ciro) }]);
        setGelirForm({ kanal: "Web Sitesi", ay: "", yil: "", ciro: "", siparis: "", urun: "", urunTutari: "" });
      };

      const handleGiderEkle = () => {
        setGiderler([...giderler, { ...giderForm, tutar: parseFloat(giderForm.tutar) }]);
        setGiderForm({ kanal: "Web Sitesi", ay: "", yil: "", tur: "", tutar: "", kdv: "", aciklama: "" });
      };

      const handleExcelImport = (e, type) => {
        Papa.parse(e.target.files[0], {
          header: true,
          complete: (results) => {
            const parsedData = results.data.map((item) => ({ ...item, tutar: parseFloat(item.tutar) }));
            if (type === "gelir") setGelirler([...gelirler, ...parsedData]);
            else setGiderler([...giderler, ...parsedData]);
          }
        });
      };

      const hesapla = (kanal) => {
        const kanalGelir = gelirler.filter((g) => g.kanal === kanal).reduce((sum, g) => sum + (parseFloat(g.ciro) || 0), 0);
        const kanalGider = giderler.filter((g) => g.kanal === kanal).reduce((sum, g) => sum + g.tutar, 0);
        let roas = "-";
        if (kanal === "Web Sitesi") {
          const reklamGideri = giderler.filter((g) => g.kanal === kanal && g.tur === "Reklam").reduce((sum, g) => sum + g.tutar, 0);
          roas = reklamGideri > 0 ? (kanalGelir / reklamGideri).toFixed(2) : "-";
        }
        return { ciro: kanalGelir, karZarar: kanalGelir - kanalGider, roas };
      };

      const web = hesapla("Web Sitesi");
      const trendyol = hesapla("Trendyol");
      const toplam = { ciro: web.ciro + trendyol.ciro, karZarar: web.karZarar + trendyol.karZarar, roas: "-" };

      return (
        <div className="max-w-5xl mx-auto space-y-10">
          <h1 className="text-3xl font-bold">Kar Zarar Paneli</h1>

          <section className="bg-white p-6 rounded shadow">
            <h2 className="text-xl font-semibold mb-4">Gelir Girişi</h2>
            <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
              <select className="border p-2 rounded" value={gelirForm.ay} onChange={(e) => setGelirForm({ ...gelirForm, ay: e.target.value })}>
                <option value="">Ay Seç</option>
                {aylar.map((a) => <option key={a}>{a}</option>)}
              </select>
              <select className="border p-2 rounded" value={gelirForm.yil} onChange={(e) => setGelirForm({ ...gelirForm, yil: e.target.value })}>
                <option value="">Yıl Seç</option>
                {yillar.map((y) => <option key={y}>{y}</option>)}
              </select>
              <input className="border p-2 rounded" placeholder="Ciro" value={gelirForm.ciro} onChange={(e) => setGelirForm({ ...gelirForm, ciro: e.target.value })} />
              <input className="border p-2 rounded" placeholder="Sipariş Adedi" value={gelirForm.siparis} onChange={(e) => setGelirForm({ ...gelirForm, siparis: e.target.value })} />
              <input className="border p-2 rounded" placeholder="Ürün Adedi" value={gelirForm.urun} onChange={(e) => setGelirForm({ ...gelirForm, urun: e.target.value })} />
              <input className="border p-2 rounded" placeholder="Ürün Tutarı" value={gelirForm.urunTutari} onChange={(e) => setGelirForm({ ...gelirForm, urunTutari: e.target.value })} />
              <select className="border p-2 rounded" value={gelirForm.kanal} onChange={(e) => setGelirForm({ ...gelirForm, kanal: e.target.value })}>
                <option>Web Sitesi</option>
                <option>Trendyol</option>
              </select>
            </div>
            <div className="mt-4 flex gap-4 items-center">
              <button onClick={handleGelirEkle} className="bg-green-600 text-white px-4 py-2 rounded">Ekle</button>
              <input type="file" accept=".csv" onChange={(e) => handleExcelImport(e, 'gelir')} />
            </div>
          </section>

          <section className="bg-white p-6 rounded shadow">
            <h2 className="text-xl font-semibold mb-4">Gider Girişi</h2>
            <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
              <select className="border p-2 rounded" value={giderForm.ay} onChange={(e) => setGiderForm({ ...giderForm, ay: e.target.value })}>
                <option value="">Ay Seç</option>
                {aylar.map((a) => <option key={a}>{a}</option>)}
              </select>
              <select className="border p-2 rounded" value={giderForm.yil} onChange={(e) => setGiderForm({ ...giderForm, yil: e.target.value })}>
                <option value="">Yıl Seç</option>
                {yillar.map((y) => <option key={y}>{y}</option>)}
              </select>
              <select className="border p-2 rounded" value={giderForm.tur} onChange={(e) => setGiderForm({ ...giderForm, tur: e.target.value })}>
                <option value="">Gider Türü</option>
                {giderTurleri.map((t) => <option key={t}>{t}</option>)}
              </select>
              <input className="border p-2 rounded" placeholder="Tutar" value={giderForm.tutar} onChange={(e) => setGiderForm({ ...giderForm, tutar: e.target.value })} />
              <select className="border p-2 rounded" value={giderForm.kdv} onChange={(e) => setGiderForm({ ...giderForm, kdv: e.target.value })}>
                <option value="">KDV</option>
                {[0, 10, 20, 100].map((k) => <option key={k}>%{k}</option>)}
              </select>
              <input className="border p-2 rounded" placeholder="Açıklama" value={giderForm.aciklama} onChange={(e) => setGiderForm({ ...giderForm, aciklama: e.target.value })} />
              <select className="border p-2 rounded" value={giderForm.kanal} onChange={(e) => setGiderForm({ ...giderForm, kanal: e.target.value })}>
                {kanalSecenekleri.map((k) => <option key={k}>{k}</option>)}
              </select>
            </div>
            <div className="mt-4 flex gap-4 items-center">
              <button onClick={handleGiderEkle} className="bg-blue-600 text-white px-4 py-2 rounded">Ekle</button>
              <input type="file" accept=".csv" onChange={(e) => handleExcelImport(e, 'gider')} />
            </div>
          </section>

          <section className="bg-white p-6 rounded shadow">
            <h2 className="text-xl font-semibold mb-4">Özet</h2>
            <table className="w-full border">
              <thead className="bg-gray-200">
                <tr>
                  <th className="border p-2">Kanal</th>
                  <th className="border p-2">Ciro</th>
                  <th className="border p-2">Kar / Zarar</th>
                  <th className="border p-2">ROAS</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td className="border p-2">Web Sitesi</td>
                  <td className="border p-2">{web.ciro.toFixed(2)} TL</td>
                  <td className="border p-2">{web.karZarar.toFixed(2)} TL</td>
                  <td className="border p-2">{web.roas}</td>
                </tr>
                <tr>
                  <td className="border p-2">Trendyol</td>
                  <td className="border p-2">{trendyol.ciro.toFixed(2)} TL</td>
                  <td className="border p-2">{trendyol.karZarar.toFixed(2)} TL</td>
                  <td className="border p-2">-</td>
                </tr>
                <tr className="font-bold bg-gray-100">
                  <td className="border p-2">Toplam</td>
                  <td className="border p-2">{toplam.ciro.toFixed(2)} TL</td>
                  <td className="border p-2">{toplam.karZarar.toFixed(2)} TL</td>
                  <td className="border p-2">-</td>
                </tr>
              </tbody>
            </table>
          </section>
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById('root')).render(<KarZararPaneli />);
  </script>
</body>
</html>
